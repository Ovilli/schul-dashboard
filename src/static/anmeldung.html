<style>
    b.key {
        display: inline-block;
        width: 120px;
    }

    .form-group label {
        width: 120px;
        float: left;
    }

    input.form-control {
        /* display: inline-block; */
        /* width: auto; */

    }
</style>

<div class='container' style='padding-top: 30px;'>
    <div class='row'>
        <div class='col-md-12'>
            <h3>Anmeldung zum Tag der Offenen Tür</h3>
            <p>
                Hier haben Sie die Möglichkeit, sich für den Tag der Offenen Tür am <strong>Samstag, den 8. Januar
                2022</strong>, anzumelden. Aufgrund aktualisierter Vorgaben gilt eine Anmeldung für jeweils für <strong>ein 
                Kind</strong> plus <strong>eine Begleitperson</strong>.
                Sie beinhaltet die Teilnahme an der Infoveranstaltung in der Aula, an einem 
                begleiteten Rundgang durch das Schulhaus und dem Schnupperunterricht Latein. Zurzeit gehen wir
                davon aus, dass wir die Veranstaltung in Präsenz anbieten können, eine Teilnahme ist nach dem 2G-Modell
                (Geimpft/Genesen) nach aktuellem Stand möglich.
            </p>

            <p>Die Teilnehmer:innenzahl pro Schiene ist aufgrund der Pandemielage begrenzt. Plätze werden nach der
                Reihenfolge der Anmeldung vergeben. Sie erhalten nach erfolgter Anmeldung eine Bestätigung per E-Mail.
                Wir bitten Sie darum, uns zu benachrichtigen, falls Sie nicht an dem gebuchten Termin teilnehmen können,
                damit wir den Platz neu vergeben können.</p>

            <p>Die <strong>SESB-Schiene</strong> (Staatliche Europaschule Berlin) richtet sich an Schülerinnen und
                Schüler mit <strong>griechischer Muttersprache</strong>.</p>

            <p>Wenn Sie sich zur Teilnahme an unserer <strong>Online-Schiene</strong> entscheiden, haben Sie die
                Möglichkeit, im Livestream Fragen per Chat zu stellen.</p>

            <hr />
            <!-- <hr /> -->
            <div>
                <div class="table-responsive" style="max-width: 100%; overflow-x: auto;">
                    <table class='table table-narrow narrow'>
                        #{print_public_event_table()}
                    </table>
                </div>
                <div class="form-group row">
                    <label for="ti_name" class="col-md-2 col-form-label">Name:</label>
                    <div class="col-md-10">
                        <input type="text" class="form-control" id="ti_name" placeholder="Name">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="ti_email" class="col-md-2 col-form-label">E-Mail:</label>
                    <div class="col-md-10">
                        <input type="email" class="form-control" id="ti_email" placeholder="E-Mail-Adresse">
                    </div>
                </div>
                <hr />
                <div style='text-align: center;'>
                    <button id='bu_submit' type="submit" class="btn btn-success" disabled><i
                            class='fa fa-send'></i>&nbsp;&nbsp;Termin buchen</button>
                </div>
                <div id='thankyou' class='alert alert-success' style='display: none;'>
                    Vielen Dank für Ihre Anmeldung! Wir haben Ihnen eine E-Mail zur Anmeldebestätigung gesendet.
                </div>
                <div id='error' class='alert alert-danger' style='display: none;'>
                    Fehler bei der Buchung.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function collect_data() {
        let data = {};
        data.name = $('#ti_name').val().trim();
        data.email = $('#ti_email').val().trim();
        data.track = null;
        let selected_buttons = $('.bu-track.selected');
        if (selected_buttons.length === 1)
            data.track = $(selected_buttons[0]).data('track');
        return data;
    }

    function update_submit_button() {
        let data = collect_data();
        let can_submit = true;
        if (data.name.length === 0) can_submit = false;
        if (data.email.length === 0) can_submit = false;
        if (data.track === null) can_submit = false;
        $('#bu_submit').prop('disabled', !can_submit);
    }

    window.addEventListener('load', function () {
        $('.bu-track').click(function (e) {
            let which = $(e.target).closest('.bu-track');
            let prev = $('.bu-track.selected');
            prev.removeClass('selected');
            prev.removeClass('btn-info');
            prev.addClass('btn-outline-info');
            prev.html('auswählen');
            which.addClass('selected');
            which.removeClass('btn-outline-info');
            which.addClass('btn-info');
            which.html("<i class='fa fa-check'></i>&nbsp;&nbsp;ausgewählt");
            update_submit_button();
        });
        $('input').keyup(function (e) {
            update_submit_button();
        });
        $('input').keydown(function (e) {
            update_submit_button();
        });
        $('input').change(function (e) {
            update_submit_button();
        });
        $('#bu_submit').click(function (e) {
            let data = collect_data();
            $('.bu-track').prop('disabled', true);
            $('#ti_name').prop('disabled', true);
            $('#ti_email').prop('disabled', true);
            api_call('/api/sign_up_for_event', { name: data.name, email: data.email, track: data.track }, function (data) {
                console.log(data);
                if (data.success) {
                    $('#bu_submit').slideUp();
                    $('#thankyou').slideDown();
                } else {
                    $('#bu_submit').slideUp();
                    $('#error').slideDown();
                }
            });
        });
    });
</script>