#{require_user_who_can_manage_news!}
<style>
    b.key {
        display: inline-block;
        width: 120px;
    }

    .form-group label {
        width: 120px;
        float: left;
    }

    input.form-control {
        /* display: inline-block; */
        /* width: auto; */

    }
</style>

<div class="modal" id="bookingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"></h5>
        </div>
        <div class="modal-body">
            <div class='container-fluid' style='padding: 0;'>
              <div class='row'>
                  <div class='col-md-12' id='ti_booking_text'></div>
              </div>
              <div class="form-group row">
                <label for="staticEmail" class="col-sm-2 col-form-label">Name:</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="ti_name">
                </div>
              </div>
              <div class="form-group row">
                <label for="staticEmail" class="col-sm-2 col-form-label">E-Mail:</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="ti_email">
                </div>
              </div>
            </div>
            <div id='thankyou' class='alert alert-success' style='display: none;'>
                Vielen Dank für Ihre Anmeldung! Wir haben Ihnen eine E-Mail zur Anmeldebestätigung gesendet.
            </div>
            <div id='error' class='alert alert-danger' style='display: none;'>
                Leider ist bei der Buchung ein Fehler aufgetreten. Versuchen Sie es bitte später noch einmal.
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class='fa fa-times'></i>&nbsp;&nbsp;Abbrechen</button>
            <button id='bu_submit' type='button' class="btn btn-success"><i class='fa fa-send'></i>&nbsp;&nbsp;Buchung abschließen</button>
        </div>
      </div>
    </div>
</div>

<div class='container' style='padding-top: 30px;'>
    <div class='row'>
        <div class='col-md-12'>
            <div>
                #{print_public_event_table()}
                <!-- <div class="table-responsive" style="max-width: 100%; overflow-x: auto;">
                    <table class='table table-narrow narrow'>
                    </table>
                </div>
                <div class="form-group row">
                    <label for="ti_name" class="col-md-2 col-form-label">Name:</label>
                    <div class="col-md-10">
                        <input type="text" class="form-control" id="ti_name" placeholder="Name">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="ti_email" class="col-md-2 col-form-label">E-Mail:</label>
                    <div class="col-md-10">
                        <input type="email" class="form-control" id="ti_email" placeholder="E-Mail-Adresse">
                    </div>
                </div>
                <hr />
                <div style='text-align: center;'>
                    <button id='bu_submit' type="submit" class="btn btn-success" disabled><i
                            class='fa fa-send'></i>&nbsp;&nbsp;Anmelden</button>
                </div>
                <div id='thankyou' class='alert alert-success' style='display: none;'>
                    Vielen Dank für Ihre Anmeldung! Wir haben Ihnen eine E-Mail zur Anmeldebestätigung gesendet.
                </div>
                <div id='error' class='alert alert-danger' style='display: none;'>
                    Fehler bei der Buchung.
                </div> -->
            </div>
        </div>
    </div>
</div>

<script>
    function collect_data() {
        let data = {};
        data.name = $('#ti_name').val().trim();
        data.email = $('#ti_email').val().trim();
        return data;
    }

    function update_submit_button() {
        let data = collect_data();
        let can_submit = true;
        if (data.name.length === 0) can_submit = false;
        if (data.email.length === 0) can_submit = false;
        // if (data.track === null) can_submit = false;
        $('#bu_submit').prop('disabled', !can_submit);
    }

    window.addEventListener('load', function () {
        $('.bu-book-public-event').click(function (e) {
            let td = $(e.target).closest('td');
            $('#ti_booking_text').html(td.find('.booking-text').html());
            let table_div = $(e.target).closest('.table-responsive');
            console.log(table_div.find('.event-title').html());
            $('#bookingModal .modal-title').html(table_div.find('.event-title').html());
            $('#bookingModal').modal('show');
            update_submit_button();
        });
        $('input').keyup(function (e) {
            update_submit_button();
        });
        $('input').keydown(function (e) {
            update_submit_button();
        });
        $('input').change(function (e) {
            update_submit_button();
        });
        $('#bu_submit').click(function (e) {
            let data = collect_data();
            $('.bu-track').prop('disabled', true);
            $('#ti_name').prop('disabled', true);
            $('#ti_email').prop('disabled', true);
            api_call('/api/sign_up_for_event', { name: data.name, email: data.email, track: data.track }, function (data) {
                console.log(data);
                if (data.success) {
                    $('#bu_submit').slideUp();
                    $('#thankyou').slideDown();
                } else {
                    $('#bu_submit').slideUp();
                    $('#error').slideDown();
                }
            });
        });
    });
</script>