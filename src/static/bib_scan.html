#{File.read('/static/_bib_public_template.html')}
#{require_user_who_can_manage_bib!}
<div class='container bg-white'>
    <div class='row'>
        <div class="col-md-6">
            <div id='barcode_widget'></div>
        </div>
        <div class="col-md-6">
            <img id="cover" style="max-width: 30%;"></img><br />
            <i class='fa fa-check'></i>&nbsp;&nbsp;Buch hat eine ISBN<br />
            <i class='fa fa-check'></i>&nbsp;&nbsp;Buch hat ein Cover<br />
            <i class='fa fa-check'></i>&nbsp;&nbsp;Buch hat Lagerort<br />
            <i class='fa fa-check'></i>&nbsp;&nbsp;Label hat Pr√ºfsumme<br />
            <hr />
            <button class='btn btn-sm btn-success ml-1 mr-1'>ISBN scannen</button>
            <button class='btn btn-sm btn-success ml-1 mr-1'>Cover fotografieren</button>
            <button class='btn btn-sm btn-success ml-1 mr-1'>Regal scannen</button>
    </div>
    </div>
</div>
<script>
    var divs_for_signature = {};
    var table = null;

    function on_scan(barcode, scanned) {
        let parts = fix_scanned_book_barcode(barcode);
        if (parts === null) {
            let _ = beep_fail.cloneNode(); _.play();
            return;
        }
        let data = {
            stem: parts.stem,
            bnr: parts.bnr
        };
        if (parts.checksum) data.checksum = parts.checksum;
        bib_api_call('/jwt/scan_book', data, function (data) {
            console.log(data);
            if (data.success) {
                let _ = beep1.cloneNode(); _.play();
                let book = data.book;
                if (book.has_cover) {
                    $('#cover').attr('src', `${BIB_HOST}/gen/covers/${book.stem}-400.jpg`).show();
                } else {
                    $('#cover').hide();
                }
            } else {
                let _ = beep_fail.cloneNode(); _.play();
            }
        });
    }

    window.addEventListener('load', function () {
        let widget = new BarcodeWidget({
            element: $('#barcode_widget'),
            on_scan: on_scan
        });
    });
</script>