#{this_is_a_page_for_logged_in_teachers}
<div class='container-fluid' style='padding-top: 30px;'>
    <div class='row'>
        <div class='col-lg-8 col-md-12 offset-md-2 '>
            <div id='calendar' style='margin-bottom: 30px;'>
            </div>
        </div>
    </div>
</div>

<style>
.fc-button-primary {
    background-color: #{desaturated_color};
    border: 1px solid #{desaturated_color};
    color: #fff;
}

.fc-button-primary:hover, .fc-button-primary:active {
    background-color: #{desaturated_color_darker};
    border: 1px solid #{desaturated_color_darker};
    color: #fff;
}

.card {
    background-color: rgba(255,255,255,0.5);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    moment.locale('de');
    let narrow_window = ($(window).width() <= 640);
    let initial_date = '#{initial_date}';
    let options = {
        initialView: narrow_window ? 'listMonth' : 'dayGridMonth',
        headerToolbar: {start: 'title', center: '', end: 'today prev,next'},
        locale: 'de',
        initialDate: initial_date,
        events: function(info, successCallback, failureCallback) {
            console.log(info);
            let start_date = new Date(info.startStr);
            let ym_date = start_date.getFullYear();
            let month = '' + (start_date.getMonth() + 1);
            if (month.length < 2) month = '0' + month;
            ym_date += `-${month}`;
            api_call('/api/get_tests', {start_date: info.startStr.substr(0, 10)}, function(data) {
                if (data.success) {
                    console.log(data);
                    data.events = data.events.map(function(x) {
                        x.color = color_palette.primary;
                        return x;
                    });
                    successCallback(data.events);
                }
            });
        },
        slotEventOverlap: false,
        slotLabelFormat: {
            hour: 'numeric',
            minute: '2-digit',
            omitZeroMinute: false
        }
    };
    if ('#{!!@session_user[:teacher]}' === 'false') {
        let d0 = moment(initial_date).day(1).subtract(28, 'days').format('YYYY-MM-DD');
        options.validRange = {
            start: d0
        };
    }

    let calendar = new FullCalendar.Calendar(document.getElementById('calendar'), options);
    calendar.render();
});
</script>
