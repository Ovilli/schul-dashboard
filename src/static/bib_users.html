#{File.read('/static/_bib_public_template.html')}
#{require_user_who_can_manage_bib!}
<div class='container bg-white'>
    <div id="users_here"></div>
</div>
<script>
    window.addEventListener('load', function () {
        bib_api_call('/jwt/get_users', {}, function (data) {
            if (data.success) {
                let div = $('<div>');
                $('#users_here').append(div);
                let table = new SortableTable({
                    element: div,
                    headers: ['Nachname', 'Vorname', 'Klasse', 'Ausgeliehen'].map(function (x) {
                        let th = $('<th>').text(x);
                        if (['Klasse', 'Ausgeliehen'].indexOf(x) >= 0) th.data('type', 'int');
                        return th;
                    }),
                    rows: data.users.filter(function(x) {
                        return x.email.indexOf('(') != 0;
                    }).map(function (entry) {
                        return [
                            create_user_td_span(entry.email),
                            $('<td>').html((db_user_info[entry.email] || {}).klasse || '&ndash;').data('sort_value', (db_user_info[entry.email] || {}).klassen_order),
                            $('<td>').html(`${entry.ausleih_count === 0 ? '&ndash;': entry.ausleih_count}`).data('sort_value', entry.ausleih_count || 0)
                        ];
                    }),
                    clickable_rows: true
                });
                table.sort_rows(0, false);
                table.sort_rows(2, false);
            }
        });
    });
</script>