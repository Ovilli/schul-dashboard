#{File.read('/static/_bib_public_template.html')}
#{require_user_who_can_manage_bib!}
<style>
    #book_subtitle,
    #book_verlag_jahr_seiten_preis {
        font-style: italic;
    }

    #book_details h5 {
        margin: 0;
    }

    #book_details {
        margin-bottom: 1em;
    }

    label {
        margin: 0;
    }

    input:invalid {
        border: 3px solid red;
    }
</style>
<div class='container bg-white'>
    <div id='book_here'>
        <div class="row">
            <div class="col-md-3">
                <div id='book_cover_container' class='pull-left mr-3 mb-3 bg-stone-800 shadow shadow-md'
                    style="width: 100%;">
                    <img id='book_cover' class=' text-center italic text-sm' style='width: 100%;' />
                </div>

            </div>
            <div class="col-md-9">
                <form>
                    <div class="form-row">
                        <div class="form-group col-md-10">
                            <label>Titel</label>
                            <input type="text" class="form-control" id="ti_title">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Signaturstamm</label>
                            <input type="text" class="form-control" id="ti_stem" disabled readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-10">
                            <label>Untertitel</label>
                            <input type="text" class="form-control" id="ti_subtitle">
                        </div>
                        <div class="form-group col-md-2">
                            <label>ISBN</label>
                            <input type="text" pattern="\d+" class="form-control" id="ti_isbn">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Autor</label>
                        <input type="text" class="form-control" id="ti_author">
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-5">
                            <label>Verlag</label>
                            <input type="text" class="form-control" id="ti_verlag">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Jahr</label>
                            <input type="text" pattern="\d{4}" class="form-control" id="ti_published">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Seiten</label>
                            <input type="text" pattern="\d*" class="form-control" id="ti_page_count">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Preis</label>
                            <input type="text" pattern="\d+(,\d{1,2})?" class="form-control" id="ti_preis">
                        </div>
                        <div class="form-group col-md-1">
                            <label>&nbsp;</label>
                            <select class='form-control' id="ti_waehrung">
                                <option value="€">€</option>
                                <option value="DM">DM</option>
                            </select>
                            <!-- <input type="text" class="form-control" id="ti_waehrung"> -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Beschreibung</label>
                        <textarea class='form-control' id="ti_description"></textarea>
                    </div>
                </form>
            </div>
        </div>

        <h3 id='book_title'></h3>
        <h4 id='book_subtitle'></h4>
        <h5 id='book_author'></h5>
        <div id='book_details'></div>
        <p id='book_description'></p>
    </div>
    <hr style='clear: both;' />
</div>
<script>
    window.addEventListener('load', function () {
        let stem = parseInt(window.location.pathname.replace('/bib_book_edit/', ''));
        bib_api_call('/jwt/get_book', { stem: stem }, function (data) {
            if (data.success) {
                let book = data.book;
                console.log(book);
                $('#ti_title').val(book.title);
                $('#ti_subtitle').val(book.subtitle);
                $('#ti_author').val(book.author);
                $('#ti_isbn').val(book.isbn);
                $('#ti_verlag').val(book.verlag);
                $('#ti_published').val(book.published);
                $('#ti_page_count').val(book.page_count);
                $('#ti_description').val(book.description);
                $('#ti_preis').val(currency_string_plain(book.preis));
                $('#ti_waehrung').val(book.waehrung);
                $('#ti_stem').val(book.stem);
                let cover = $('#book_cover');
                if (book.has_cover) {
                    cover.attr('src', `${BIB_HOST}/gen/covers/${book.stem}-400.jpg`);
                } else {
                    $('#book_cover_container').hide();
                }
            }
        });
    });
</script>