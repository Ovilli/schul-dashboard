#{require_user_who_can_manage_bib!}
#{File.read('/static/_bib_template.html')}
<div id='book_list' class="w-full grid grid-cols-12 gap-4 mb-4">
</div>
</section>
</div>
<script>
    var observer = null;

    function observer_callback(entries, observer) {
        for (let entry of entries) {
            if (entry.intersectionRatio === 0)
                continue;
            observer.unobserve(entry.target);
            let book = $(entry.target).data('book');
            $(entry.target).replaceWith(create_book_div(book, null, {preview: false, clickable: true}));
        }
    }

    window.addEventListener('load', function () {
        observer = new IntersectionObserver(observer_callback, {
            rootMargin: '0px',
            threshold: 0.0
        });

        bib_api_call('/jwt/get_books', {}, function (data) {
            for (let book of data.books) {
                // console.log(book);
                // if (book.stem == 3075)
                let div = create_book_div(book, null, {preview: true}).data('book', book);
                $('#book_list').append(div);
                observer.observe(div[0]);
            }
        });
        // $('#extralarge-modal').show();
    });
</script>
